<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NetMarket OS - TITAN Ultimate Fusion</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>

    <style>
        /* --- 1. CORE VARIABLES & THEME --- */
        :root {
            /* TITAN Core Colors */
            --primary: #d4af37; 
            --primary-dim: rgba(212, 175, 55, 0.1);
            --bg-body: #0f1115;
            --bg-sidebar: #161b22;
            --bg-card: #1f242c;
            --bg-hover: #2d333b;
            --text-main: #e6edf3;
            --text-muted: #8b949e;
            --border: #30363d;
            --radius: 8px;

            /* Utility Colors */
            --success: #00b894;
            --danger: #d63031;
            --warning: #fdcb6e;
            --info: #0984e3;
            
            /* BRAND COLORS (From Integration Code) */
            --brand-shopify: #95BF47;
            --brand-akeneo: #9D73D5;
            --brand-zendesk: #03363D;
            --brand-klaviyo: #E4405F;
            --brand-clo3d: #5f27cd;
            --brand-monday: #F22F46;

            /* Fonts */
            --font-ui: 'Inter', sans-serif;
            --font-code: 'JetBrains Mono', monospace;
        }

        /* Light Mode Variables */
        body.light-mode {
            --bg-body: #f4f6f8;
            --bg-sidebar: #ffffff;
            --bg-card: #ffffff;
            --bg-hover: #f1f1f1;
            --text-main: #24292f;
            --text-muted: #57606a;
            --border: #d0d7de;
        }

        /* --- RESET & BASE --- */
        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-body); }
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }
        
        body {
            background-color: var(--bg-body);
            color: var(--text-main);
            font-family: var(--font-ui);
            height: 100vh;
            display: flex;
            overflow: hidden;
            transition: background 0.3s, color 0.3s;
        }

        /* --- SIDEBAR --- */
        .sidebar {
            width: 280px;
            background: var(--bg-sidebar);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            padding: 20px;
            z-index: 20;
        }

        .brand {
            font-size: 1.4rem;
            font-weight: 800;
            color: var(--text-main);
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 12px;
            letter-spacing: -0.5px;
        }
        .brand i { color: var(--primary); }

        .nav-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            color: var(--text-muted);
            font-weight: 700;
            margin: 20px 0 10px 10px;
        }

        .nav-item {
            padding: 12px 15px;
            border-radius: var(--radius);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--text-muted);
            font-weight: 500;
            transition: 0.2s;
            margin-bottom: 4px;
        }
        .nav-item:hover { background: var(--bg-hover); color: var(--text-main); }
        .nav-item.active { background: var(--primary-dim); color: var(--primary); border-left: 3px solid var(--primary); }
        .nav-item i { width: 20px; text-align: center; }

        /* Server Widget */
        .server-widget {
            margin-top: auto;
            background: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: var(--radius);
            border: 1px solid var(--border);
        }
        .server-row { display: flex; justify-content: space-between; font-size: 0.8rem; margin-bottom: 5px; }
        .server-bar-bg { height: 4px; background: #333; border-radius: 2px; overflow: hidden; margin-bottom: 10px; }
        .server-bar-fill { height: 100%; background: var(--success); width: 40%; transition: width 0.5s; }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 0.5; } 50% { opacity: 1; } 100% { opacity: 0.5; } }

        /* --- MAIN CONTENT --- */
        .main-wrapper { flex: 1; display: flex; flex-direction: column; overflow: hidden; position: relative; }

        .topbar {
            height: 64px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 30px;
            background: var(--bg-sidebar);
        }
        .page-title { font-size: 1.1rem; font-weight: 600; display: flex; align-items: center; gap: 10px; }
        .live-badge { font-size: 0.7rem; background: rgba(212, 175, 55, 0.2); color: var(--primary); padding: 2px 8px; border-radius: 12px; border: 1px solid var(--primary); }

        .top-actions { display: flex; gap: 20px; align-items: center; }
        .action-btn { background: none; border: none; color: var(--text-muted); font-size: 1.1rem; cursor: pointer; position: relative; }
        .action-btn:hover { color: var(--text-main); }
        .notif-badge { position: absolute; top: -5px; right: -5px; width: 8px; height: 8px; background: var(--danger); border-radius: 50%; display: none; }
        .notif-badge.active { display: block; }

        /* Content Area */
        .content { flex: 1; overflow-y: auto; padding: 30px; }
        .view-section { display: none; animation: slideUp 0.4s ease; }
        .view-section.active { display: block; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* --- DASHBOARD WIDGETS --- */
        .grid-4 { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 25px; margin-bottom: 30px; }
        .stat-card {
            background: var(--bg-card); padding: 25px; border-radius: var(--radius); border: 1px solid var(--border);
            position: relative; overflow: hidden; transition: transform 0.2s;
        }
        .stat-card:hover { transform: translateY(-5px); border-color: var(--text-muted); }
        .stat-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .stat-icon { width: 40px; height: 40px; background: var(--bg-hover); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: var(--primary); font-size: 1.2rem; }
        .stat-val { font-size: 2rem; font-weight: 700; color: var(--text-main); font-family: var(--font-code); }
        .stat-label { font-size: 0.9rem; color: var(--text-muted); margin-top: 5px; }
        .trend { font-size: 0.8rem; font-weight: 600; display: flex; align-items: center; gap: 5px; margin-top: 10px; }
        .trend.up { color: var(--success); }
        .trend.down { color: var(--danger); }

        /* --- KANBAN BOARD --- */
        .kanban-board { display: flex; gap: 20px; overflow-x: auto; padding-bottom: 20px; height: calc(100vh - 200px); }
        .kanban-col { min-width: 300px; background: var(--bg-sidebar); border-radius: 12px; border: 1px solid var(--border); display: flex; flex-direction: column; }
        .kanban-header { padding: 15px; border-bottom: 1px solid var(--border); font-weight: 700; display: flex; justify-content: space-between; }
        .kanban-count { background: var(--bg-hover); padding: 2px 8px; border-radius: 10px; font-size: 0.8rem; }
        .kanban-body { padding: 15px; flex: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        .task-card {
            background: var(--bg-card); padding: 15px; border-radius: 8px; border: 1px solid var(--border);
            cursor: grab; transition: 0.2s; box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .task-card:hover { border-color: var(--primary); }
        .task-tag { font-size: 0.7rem; padding: 2px 6px; border-radius: 4px; background: var(--primary-dim); color: var(--primary); display: inline-block; margin-bottom: 8px; }
        .task-title { font-weight: 600; margin-bottom: 8px; font-size: 0.95rem; }
        .task-meta { display: flex; justify-content: space-between; font-size: 0.8rem; color: var(--text-muted); }
        .task-img { width: 100%; height: 100px; object-fit: cover; border-radius: 4px; margin-bottom: 10px; background: #333; }

        /* --- TABLES --- */
        .table-container { background: var(--bg-card); border-radius: var(--radius); border: 1px solid var(--border); overflow: hidden; margin-bottom: 30px; }
        .data-table { width: 100%; border-collapse: collapse; }
        .data-table th, .data-table td { padding: 15px 20px; text-align: left; border-bottom: 1px solid var(--border); }
        .data-table th { background: var(--bg-sidebar); color: var(--text-muted); font-weight: 600; font-size: 0.85rem; text-transform: uppercase; }
        .data-table tr:hover { background: var(--bg-hover); }
        .data-table tr:last-child td { border-bottom: none; }
        .status-badge { padding: 4px 10px; border-radius: 20px; font-size: 0.75rem; font-weight: 700; }
        .st-success { background: rgba(0, 184, 148, 0.15); color: var(--success); }
        .st-warning { background: rgba(253, 203, 110, 0.15); color: var(--warning); }
        .st-danger { background: rgba(214, 48, 49, 0.15); color: var(--danger); }
        .btn-sim { background: var(--primary); color: #000; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 0.85rem; display: flex; align-items: center; gap: 8px; transition: 0.2s; }
        .btn-sim:hover { background: #fff; }

        /* --- ADVANCED SIMULATION MODAL (FROM INTEGRATION CODE) --- */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); backdrop-filter: blur(5px); z-index: 1000; align-items: center; justify-content: center; }
        .modal-overlay.active { display: flex; }
        .sim-window { width: 90%; max-width: 1200px; height: 85vh; background: #0d1117; border: 1px solid var(--border); border-radius: 12px; display: flex; flex-direction: column; box-shadow: 0 0 40px rgba(0,0,0,0.5); overflow: hidden; }
        
        .sim-top { padding: 15px 25px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; background: #161b22; }
        .sim-title { font-family: var(--font-code); color: var(--primary); font-weight: 700; display: flex; align-items: center; gap: 10px; }
        
        .sim-body { flex: 1; display: flex; }
        .sim-canvas { flex: 2; background: #0d1117; position: relative; display: flex; align-items: center; justify-content: center; overflow: hidden; border-right: 1px solid var(--border); background-image: radial-gradient(#30363d 1px, transparent 1px); background-size: 20px 20px; }
        
        .node { width: 140px; background: #1f242c; border: 1px solid #30363d; border-radius: 8px; padding: 15px; text-align: center; position: absolute; transition: 0.5s; opacity: 0.3; transform: scale(0.9); z-index: 2; }
        .node.active { opacity: 1; transform: scale(1.1); border-color: var(--white); box-shadow: 0 0 20px rgba(255,255,255,0.1); z-index: 10; }
        .node-icon { width: 50px; height: 50px; margin: 0 auto 10px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; color: white; }
        .node-label { font-size: 0.8rem; font-weight: 600; color: #fff; }
        .node-sub { font-size: 0.7rem; color: #888; margin-top: 4px; }

        .connector { position: absolute; height: 2px; background: #30363d; top: 50%; z-index: 1; width: 0; transition: width 0.5s; left: 0; }
        .connector.active { background: var(--success); box-shadow: 0 0 10px var(--success); }

        .sim-console { flex: 1; background: #000; padding: 20px; font-family: var(--font-code); font-size: 0.8rem; overflow-y: auto; color: #c9d1d9; display: flex; flex-direction: column; }
        .console-line { margin-bottom: 5px; opacity: 0; animation: slideIn 0.2s forwards; }
        .key { color: #79c0ff; }
        .string { color: #a5d6ff; }
        .bracket { color: #f0f6fc; }
        @keyframes slideIn { from { transform: translateX(10px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        .sim-controls { padding: 20px; border-top: 1px solid var(--border); background: #161b22; display: flex; justify-content: center; }

        /* --- UTILS --- */
        .toast-container { position: fixed; top: 80px; right: 20px; z-index: 2000; display: flex; flex-direction: column; gap: 10px; }
        .toast { width: 300px; background: var(--bg-card); border-left: 4px solid var(--primary); padding: 15px; border-radius: 4px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); transform: translateX(120%); transition: 0.3s; display: flex; justify-content: space-between; }
        .toast.show { transform: translateX(0); }
        .toast-content h4 { font-size: 0.9rem; margin-bottom: 4px; }
        .toast-content p { font-size: 0.8rem; color: var(--text-muted); }

        .settings-panel { position: absolute; top: 70px; right: 30px; width: 250px; background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; padding: 15px; display: none; box-shadow: 0 4px 12px rgba(0,0,0,0.3); z-index: 50; }
        .settings-panel.active { display: block; }
        .switch-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; font-size: 0.9rem; }
    </style>
</head>
<body id="body">

    <div class="toast-container" id="toastContainer"></div>

    <aside class="sidebar">
        <div class="brand"><i class="fas fa-cube"></i> NetMarket OS <span style="font-size:0.7rem; background:var(--primary); color:#000; padding:2px 4px; border-radius:4px;">TITAN</span></div>
        
        <div class="nav-label">Dashboards</div>
        <div class="nav-item active" onclick="switchView('home', this)"><i class="fas fa-th-large"></i> Vue d'ensemble</div>
        <div class="nav-item" onclick="switchView('kpi', this)"><i class="fas fa-chart-line"></i> Analytics & KPIs</div>

        <div class="nav-label">Modules Métiers</div>
        <div class="nav-item" onclick="switchView('design', this)"><i class="fas fa-pencil-ruler"></i> NetDesignX</div>
        <div class="nav-item" onclick="switchView('cat', this)"><i class="fas fa-tags"></i> NetCatX</div>
        <div class="nav-item" onclick="switchView('promo', this)"><i class="fas fa-bullhorn"></i> NetPromoX</div>
        <div class="nav-item" onclick="switchView('care', this)"><i class="fas fa-headset"></i> NetCareX</div>

        <div class="server-widget">
            <div class="server-row"><span><i class="fas fa-server"></i> AWS EU-West-3</span> <span class="pulse" style="color:var(--success)">● Online</span></div>
            <div class="server-row" style="margin-top:10px;"><span>CPU Usage</span> <span id="cpuVal">12%</span></div>
            <div class="server-bar-bg"><div class="server-bar-fill" id="cpuBar" style="width:12%"></div></div>
            <div class="server-row"><span>Memory</span> <span id="memVal">4.2GB</span></div>
            <div class="server-bar-bg"><div class="server-bar-fill" id="memBar" style="width:40%; background:var(--info);"></div></div>
            <div class="server-row"><span>API Latency</span> <span>24ms</span></div>
        </div>
    </aside>

    <div class="main-wrapper">
        <header class="topbar">
            <div class="page-title">
                <span id="pageTitle">Dashboard</span> 
                <span class="live-badge">LIVE DATA</span>
            </div>
            <div class="top-actions">
                <button class="action-btn" onclick="toggleSettings()"><i class="fas fa-cog"></i></button>
                <button class="action-btn" onclick="toggleNotifs()">
                    <i class="fas fa-bell"></i>
                    <span class="notif-badge active"></span>
                </button>
                <div class="action-btn" style="font-size:0.9rem; font-weight:600; color:var(--primary);">
                    <i class="fas fa-user-circle"></i> Admin
                </div>
            </div>
            
            <div class="settings-panel" id="settingsPanel">
                <h4 style="margin-bottom:15px; border-bottom:1px solid var(--border); padding-bottom:5px;">Configuration</h4>
                <div class="switch-row">
                    <span>Mode Clair/Sombre</span>
                    <button onclick="document.body.classList.toggle('light-mode')" style="cursor:pointer; padding:2px 8px;">Switch</button>
                </div>
                <div class="switch-row">
                    <span>Notifications</span>
                    <span style="color:var(--success)">ON</span>
                </div>
                <div class="switch-row">
                    <span>Version</span>
                    <span style="color:var(--text-muted)">6.2.0-ULTIMATE</span>
                </div>
            </div>
        </header>

        <div class="content">

            <section id="home" class="view-section active">
                <h2 style="margin-bottom:20px;">Performance Globale</h2>
                <div class="grid-4">
                    <div class="stat-card">
                        <div class="stat-head"><div class="stat-icon"><i class="fas fa-shopping-cart"></i></div><span class="trend up"><i class="fas fa-arrow-up"></i> +12%</span></div>
                        <div class="stat-val">124.5k€</div>
                        <div class="stat-label">Chiffre d'affaires (Jour)</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-head"><div class="stat-icon"><i class="fas fa-users"></i></div><span class="trend up"><i class="fas fa-arrow-up"></i> +5%</span></div>
                        <div class="stat-val">4,203</div>
                        <div class="stat-label">Visiteurs Actifs</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-head"><div class="stat-icon"><i class="fas fa-box"></i></div><span class="trend down"><i class="fas fa-arrow-down"></i> -2%</span></div>
                        <div class="stat-val">85</div>
                        <div class="stat-label">Retours en attente</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-head"><div class="stat-icon"><i class="fas fa-check-circle"></i></div><span class="trend up">Stable</span></div>
                        <div class="stat-val">99.9%</div>
                        <div class="stat-label">Uptime Système</div>
                    </div>
                </div>

                <div class="grid-4" style="grid-template-columns: 2fr 1fr;">
                    <div class="table-container">
                        <div style="padding:15px; border-bottom:1px solid var(--border); font-weight:600;">Flux d'Activité Récent (Logs)</div>
                        <table class="data-table">
                            <thead><tr><th>Heure</th><th>Module</th><th>Action</th><th>Statut</th></tr></thead>
                            <tbody id="activityLog"></tbody>
                        </table>
                    </div>
                    <div class="table-container" style="padding:20px;">
                        <h4 style="margin-bottom:15px;">Répartition Trafic</h4>
                        <canvas id="trafficChart"></canvas>
                    </div>
                </div>
            </section>

            <section id="design" class="view-section">
                <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
                    <h2>NetDesignX <span style="color:var(--text-muted); font-size:1rem;">| Collection Hiver 2025</span></h2>
                    <button class="btn-sim" onclick="openSim('design')"><i class="fas fa-play"></i> Simuler Workflow</button>
                </div>
                
                <div class="kanban-board">
                    <div class="kanban-col">
                        <div class="kanban-header"><span>Idéation</span><span class="kanban-count">3</span></div>
                        <div class="kanban-body">
                            <div class="task-card">
                                <div class="task-tag">Tendance WGSN</div>
                                <div class="task-title">Manteau Oversize Laine</div>
                                <div class="task-meta"><span><i class="fas fa-paperclip"></i> 2</span></div>
                            </div>
                            <div class="task-card">
                                <div class="task-tag">Retour Client</div>
                                <div class="task-title">Robe Soie (Nouvelle couleur)</div>
                            </div>
                        </div>
                    </div>
                    <div class="kanban-col">
                        <div class="kanban-header"><span>Prototypage 3D</span><span class="kanban-count">2</span></div>
                        <div class="kanban-body">
                            <div class="task-card">
                                <div class="task-img" style="background:url('https://images.unsplash.com/photo-1544441893-675973e31985?auto=format&fit=crop&w=300&q=80') center/cover;"></div>
                                <div class="task-tag">Vêtement</div>
                                <div class="task-title">Blazer Hiver v2</div>
                                <div class="task-meta"><span style="color:var(--warning)">En cours de rendu...</span></div>
                            </div>
                        </div>
                    </div>
                    <div class="kanban-col">
                        <div class="kanban-header"><span>Validé</span><span class="kanban-count">1</span></div>
                        <div class="kanban-body">
                            <div class="task-card" style="border-left:4px solid var(--success);">
                                <div class="task-title">Sneakers Urban X</div>
                                <div class="task-meta"><span style="color:var(--success)"><i class="fas fa-check"></i> Exporté NetCatX</span></div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="cat" class="view-section">
                <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
                    <h2>NetCatX <span style="color:var(--text-muted); font-size:1rem;">| PIM & Diffusion</span></h2>
                    <button class="btn-sim" onclick="openSim('cat')"><i class="fas fa-play"></i> Simuler Flux</button>
                </div>
                <div class="grid-4">
                    <div class="stat-card"><div class="stat-val">12,404</div><div class="stat-label">Produits Totaux</div></div>
                    <div class="stat-card"><div class="stat-val" style="color:var(--warning)">15</div><div class="stat-label">Erreurs Synchro</div></div>
                    <div class="stat-card"><div class="stat-val" style="color:var(--success)">100%</div><div class="stat-label">Couverture Photo</div></div>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead><tr><th>SKU</th><th>Nom Produit</th><th>Enrichissement IA</th><th>Canaux</th><th>Statut</th></tr></thead>
                        <tbody>
                            <tr><td>BST-2025</td><td>Veste Hiver Premium</td><td><span class="status-badge st-success">100% Complet</span></td><td><i class="fab fa-shopify"></i> <i class="fab fa-amazon"></i></td><td><span class="status-badge st-success">LIVE</span></td></tr>
                            <tr><td>DRS-SUM-99</td><td>Robe Été Florale</td><td><span class="status-badge st-warning">80% (Desc manquante)</span></td><td><i class="fab fa-shopify"></i></td><td><span class="status-badge st-warning">DRAFT</span></td></tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <section id="promo" class="view-section">
                <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
                    <h2>NetPromoX <span style="color:var(--text-muted); font-size:1rem;">| Marketing Automation</span></h2>
                    <button class="btn-sim" onclick="openSim('promo')"><i class="fas fa-play"></i> Simuler Campagne</button>
                </div>
                <div class="table-container" style="padding:20px; margin-bottom:20px;">
                    <canvas id="marketingChart" height="100"></canvas>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead><tr><th>Campagne</th><th>Canal</th><th>Audience</th><th>Budget</th><th>ROI</th></tr></thead>
                        <tbody>
                            <tr><td>Lancement Hiver</td><td>Email + Instagram</td><td>VIP (>200€)</td><td>15k €</td><td style="color:var(--success); font-weight:bold;">5.2x</td></tr>
                            <tr><td>Relance Panier</td><td>Email Auto</td><td>Abandon < 24h</td><td>2k €</td><td style="color:var(--success); font-weight:bold;">12.0x</td></tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <section id="care" class="view-section">
                <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
                    <h2>NetCareX <span style="color:var(--text-muted); font-size:1rem;">| Customer Success</span></h2>
                    <button class="btn-sim" onclick="openSim('care')"><i class="fas fa-play"></i> Simuler Ticket</button>
                </div>
                <div class="grid-4">
                    <div class="stat-card"><div class="stat-val">24</div><div class="stat-label">Tickets Ouverts</div></div>
                    <div class="stat-card"><div class="stat-val">1h 15m</div><div class="stat-label">Temps Réponse</div></div>
                    <div class="stat-card"><div class="stat-val">4.8/5</div><div class="stat-label">CSAT Score</div></div>
                </div>
                <div class="table-container">
                    <div style="padding:15px; border-bottom:1px solid var(--border);">Inbox Unifiée (Zendesk Integration)</div>
                    <table class="data-table">
                        <thead><tr><th>Client</th><th>Sujet</th><th>Analyse IA</th><th>Priorité</th><th>Action</th></tr></thead>
                        <tbody>
                            <tr><td>Julie M.</td><td>Problème Taille</td><td><span style="color:var(--danger)">Sentiment Négatif</span></td><td><span class="status-badge st-danger">HAUTE</span></td><td><button class="status-badge st-success" style="border:none; cursor:pointer;">Rembourser</button></td></tr>
                            <tr><td>Marc D.</td><td>Où est mon colis ?</td><td><span style="color:var(--text-muted)">Neutre</span></td><td><span class="status-badge st-warning">MOYENNE</span></td><td><button class="status-badge st-warning" style="border:none; cursor:pointer;">Tracker</button></td></tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <section id="kpi" class="view-section">
                <h2>Analytics Globaux</h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top:20px;">
                     <div class="table-container" style="padding:20px;">
                        <h4>Conversion Tunnel</h4>
                        <canvas id="funnelChart"></canvas>
                     </div>
                     <div class="table-container" style="padding:20px;">
                        <h4>Performance par Canal</h4>
                        <canvas id="radarChart"></canvas>
                     </div>
                </div>
            </section>

        </div>
    </div>

    <div id="modal" class="modal-overlay">
        <div class="sim-window">
            <div class="sim-top">
                <div class="sim-title"><i class="fas fa-terminal"></i> INTEGRATION_DEBUGGER: <span id="sim-id" style="color:white; margin-left:10px;">WORKFLOW</span></div>
                <button style="background:none; border:none; color:white; font-size:1.2rem; cursor:pointer;" onclick="closeSim()">&times;</button>
            </div>
            <div class="sim-body">
                <div class="sim-canvas" id="canvas">
                    </div>
                <div class="sim-console" id="console">
                    <div style="color:#444;">// Waiting for trigger event...</div>
                </div>
            </div>
            <div class="sim-controls">
                <button class="btn-sim" id="btn-run" onclick="runSequence()">
                    <i class="fas fa-bolt"></i> Exécuter Webhook
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- CHARTS INITIALIZATION ---
        const ctxTraffic = document.getElementById('trafficChart').getContext('2d');
        new Chart(ctxTraffic, {
            type: 'doughnut',
            data: {
                labels: ['Mobile App', 'Desktop', 'Tablet'],
                datasets: [{ data: [65, 30, 5], backgroundColor: ['#d4af37', '#6c5ce7', '#00b894'], borderWidth: 0 }]
            },
            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'right' } } }
        });

        const ctxMarketing = document.getElementById('marketingChart').getContext('2d');
        new Chart(ctxMarketing, {
            type: 'line',
            data: {
                labels: ['Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam', 'Dim'],
                datasets: [{ label: 'Ventes (€)', data: [12000, 19000, 15000, 25000, 22000, 30000, 35000], borderColor: '#d4af37', tension: 0.4 }]
            },
            options: { responsive: true, maintainAspectRatio: false }
        });

        const ctxFunnel = document.getElementById('funnelChart').getContext('2d');
        new Chart(ctxFunnel, {
            type: 'bar',
            data: {
                labels: ['Visites', 'Produit', 'Panier', 'Achat'],
                datasets: [{ label: 'Users', data: [5000, 2500, 800, 400], backgroundColor: ['#58a6ff', '#4dabf7', '#d4af37', '#00b894'] }]
            },
            options: { indexAxis: 'y', responsive: true }
        });

        const ctxRadar = document.getElementById('radarChart').getContext('2d');
        new Chart(ctxRadar, {
            type: 'radar',
            data: {
                labels: ['Email', 'Social', 'Ads', 'Organic', 'Direct'],
                datasets: [{ label: 'Traffic Score', data: [80, 90, 60, 70, 85], backgroundColor: 'rgba(212, 175, 55, 0.2)', borderColor: '#d4af37' }]
            },
            options: { scales: { r: { grid: { color: '#333' } } } }
        });

        // --- NAVIGATION ---
        function switchView(id, el) {
            document.querySelectorAll('.view-section').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            el.classList.add('active');
            document.getElementById('pageTitle').innerText = "Dashboard / " + id.charAt(0).toUpperCase() + id.slice(1);
        }

        function toggleSettings() {
            document.getElementById('settingsPanel').classList.toggle('active');
        }
        function toggleNotifs() {
            document.querySelector('.notif-badge').style.display = 'none';
            showToast("Info", "Pas de nouvelles notifications.");
        }

        // --- WIDGETS ANIMATIONS ---
        setInterval(() => {
            const cpu = Math.floor(Math.random() * 30) + 10;
            document.getElementById('cpuVal').innerText = cpu + '%';
            document.getElementById('cpuBar').style.width = cpu + '%';
        }, 2000);

        // --- ACTIVITY LOG ---
        const actions = [
            { mod: 'NetCatX', act: 'Sync Shopify', stat: 'Success' },
            { mod: 'NetCareX', act: 'New Ticket #884', stat: 'Pending' },
            { mod: 'NetPromoX', act: 'Email Sent', stat: 'Success' },
            { mod: 'NetDesignX', act: '3D Render', stat: 'Processing' }
        ];
        const logTable = document.getElementById('activityLog');
        function addLog() {
            const action = actions[Math.floor(Math.random() * actions.length)];
            const time = new Date().toLocaleTimeString();
            const row = `<tr><td>${time}</td><td style="font-weight:600">${action.mod}</td><td>${action.act}</td><td><span class="status-badge st-${action.stat === 'Success' ? 'success' : 'warning'}">${action.stat}</span></td></tr>`;
            logTable.insertAdjacentHTML('afterbegin', row);
            if(logTable.rows.length > 5) logTable.deleteRow(5);
        }
        setInterval(addLog, 3500);

        function showToast(title, msg) {
            const container = document.getElementById('toastContainer');
            const el = document.createElement('div');
            el.className = 'toast';
            el.innerHTML = `<div class="toast-content"><h4>${title}</h4><p>${msg}</p></div><i class="fas fa-times" style="cursor:pointer; color:#888;" onclick="this.parentElement.remove()"></i>`;
            container.appendChild(el);
            setTimeout(() => el.classList.add('show'), 100);
            setTimeout(() => { el.classList.remove('show'); setTimeout(() => el.remove(), 300); }, 5000);
        }

        // --- SIMULATION ENGINE ---
        const scenarios = {
            'design': {
                name: 'DESIGN_PIPELINE',
                nodes: [
                    { label: 'WGSN Trend', sub: 'Webhook Trigger', icon: 'fa-globe', color: '#000' },
                    { label: 'CLO 3D', sub: 'Asset Generation', icon: 'fa-cube', color: 'var(--brand-clo3d)' },
                    { label: 'Monday.com', sub: 'Validation Board', icon: 'fa-check-square', color: 'var(--brand-monday)' }
                ],
                logs: [
                    { t: 0, code: `TRIGGER: New_Trend_Detected { category: "Winter_Coats" }` },
                    { t: 800, code: `FETCH: WGSN API > Downloading assets...` },
                    { t: 1600, code: `PROCESS: CLO3D Render generating (glTF format)...` },
                    { t: 2400, code: `POST: https://api.monday.com/v2/items` },
                    { t: 3200, code: `RESPONSE: 201 Created { item_id: 884920 }` }
                ]
            },
            'cat': {
                name: 'CATALOGUE_SYNC',
                nodes: [
                    { label: 'ERP Oracle', sub: 'Database Update', icon: 'fa-database', color: '#c74634' },
                    { label: 'Akeneo PIM', sub: 'Data Enrichment', icon: 'fa-layer-group', color: 'var(--brand-akeneo)' },
                    { label: 'Shopify Plus', sub: 'Storefront Push', icon: 'fab fa-shopify', color: 'var(--brand-shopify)' }
                ],
                logs: [
                    { t: 0, code: `WATCH: ERP_Table_SKU_Update` },
                    { t: 800, code: `PAYLOAD: { sku: "BST-2025", stock: 150, price: 120.00 }` },
                    { t: 1600, code: `PIM: Enriching description via OpenAI GPT-4...` },
                    { t: 2400, code: `SYNC: Pushing to Shopify Admin API...` },
                    { t: 3200, code: `SUCCESS: Product ID 443219 updated.` }
                ]
            },
            'promo': {
                name: 'MARKETING_AUTO',
                nodes: [
                    { label: 'Shopify', sub: 'Cart Abandoned', icon: 'fa-shopping-cart', color: 'var(--brand-shopify)' },
                    { label: 'Segment', sub: 'CDP Routing', icon: 'fa-random', color: '#27ae60' },
                    { label: 'Klaviyo', sub: 'Email Flow', icon: 'fa-envelope', color: 'var(--brand-klaviyo)' }
                ],
                logs: [
                    { t: 0, code: `EVENT: Checkout_Abandoned { value: 240€, user_id: "u_992" }` },
                    { t: 800, code: `CDP: Identifying user traits...` },
                    { t: 1600, code: `SEGMENT: Route to 'High_Value_Audience'` },
                    { t: 2400, code: `KLAVIYO: Trigger Flow 'Recovery_Discount_10'` },
                    { t: 3200, code: `EMAIL: Sent to u_992@gmail.com` }
                ]
            },
            'care': {
                name: 'TICKET_ROUTING',
                nodes: [
                    { label: 'Zendesk', sub: 'New Ticket', icon: 'fa-ticket-alt', color: 'var(--brand-zendesk)' },
                    { label: 'OpenAI', sub: 'Sentiment Analysis', icon: 'fa-brain', color: '#10a37f' },
                    { label: 'Shopify', sub: 'Refund Action', icon: 'fa-undo', color: 'var(--brand-shopify)' }
                ],
                logs: [
                    { t: 0, code: `WEBHOOK: ticket.created { subject: "Defect" }` },
                    { t: 800, code: `AI: Analyzing sentiment... Score: -0.8 (Very Negative)` },
                    { t: 1600, code: `DECISION: Auto-Refund Eligible (Policy #22)` },
                    { t: 2400, code: `ACTION: POST /admin/orders/882/refunds.json` },
                    { t: 3200, code: `REPLY: Auto-response sent to customer.` }
                ]
            }
        };

        let currentScenario = null;

        function openSim(key) {
            currentScenario = scenarios[key];
            document.getElementById('sim-id').innerText = key.toUpperCase() + "_PIPELINE";
            document.getElementById('modal').classList.add('active');
            const canvas = document.getElementById('canvas');
            canvas.innerHTML = '';
            
            // Positions: 20% - 50% - 80%
            const positions = ['20%', '50%', '80%'];
            
            currentScenario.nodes.forEach((node, index) => {
                const el = document.createElement('div');
                el.className = 'node';
                el.id = `node-${index}`;
                el.style.left = positions[index];
                el.innerHTML = `<div class="node-icon" style="background:${node.color}"><i class="${node.icon}"></i></div><div class="node-label">${node.label}</div><div class="node-sub">${node.sub}</div>`;
                canvas.appendChild(el);

                if (index < currentScenario.nodes.length - 1) {
                    const conn = document.createElement('div');
                    conn.className = 'connector';
                    conn.id = `conn-${index}`;
                    conn.style.left = `calc(${positions[index]} + 70px)`;
                    conn.style.width = '30%';
                    canvas.appendChild(conn);
                }
            });

            document.getElementById('console').innerHTML = '<div style="color:#666">// Ready to execute.</div>';
            document.getElementById('btn-run').disabled = false;
        }

        function closeSim() { document.getElementById('modal').classList.remove('active'); }

        function runSequence() {
            document.getElementById('btn-run').disabled = true;
            document.getElementById('console').innerHTML = '';
            const logs = currentScenario.logs;
            
            logs.forEach((log, i) => {
                setTimeout(() => {
                    const line = document.createElement('div');
                    line.className = 'console-line';
                    line.innerHTML = `<span style="color:#555;">${new Date().toLocaleTimeString()}</span> <span style="color:#fff;">${highlightJSON(log.code)}</span>`;
                    const consoleEl = document.getElementById('console');
                    consoleEl.appendChild(line);
                    consoleEl.scrollTop = consoleEl.scrollHeight;

                    if(i === 0) highlightNode(0);
                    if(i === 2) { activateConnector(0); highlightNode(1); }
                    if(i === 3) { activateConnector(1); highlightNode(2); }
                    
                    if(i === logs.length - 1) {
                        showToast('Succès', 'Workflow exécuté avec succès.');
                        document.getElementById('btn-run').disabled = false;
                    }
                }, log.t);
            });
        }

        function highlightNode(index) {
            document.querySelectorAll('.node').forEach(n => n.classList.remove('active'));
            const n = document.getElementById(`node-${index}`);
            if(n) n.classList.add('active');
        }

        function activateConnector(index) {
            const c = document.getElementById(`conn-${index}`);
            if(c) {
                c.style.transition = 'background 0.5s';
                c.style.background = 'var(--success)';
                c.style.boxShadow = '0 0 10px var(--success)';
                setTimeout(() => { c.style.background = '#30363d'; c.style.boxShadow = 'none'; }, 1000);
            }
        }

        function highlightJSON(str) {
            return str.replace(/{/g, '<span class="bracket">{</span>')
                      .replace(/}/g, '<span class="bracket">}</span>')
                      .replace(/([a-zA-Z0-9_]+):/g, '<span class="key">$1:</span>')
                      .replace(/"(.*?)"/g, '<span class="string">"$1"</span>');
        }
    </script>
</body>
</html>
