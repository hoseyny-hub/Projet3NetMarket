<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NetMarket OS - TITAN V8 Hybrid</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=JetBrains+Mono:wght@400;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root{
      --primary:#d4af37; --primary-dim: rgba(212,175,55,.15);
      --bg-deep:#0b0c10; --bg-sidebar:#111418; --bg-panel:#1a1d21;
      --border:#2d3238; --text-main:#e0e6ed; --text-muted:#949ba3;
      --success:#51cf66; --danger:#ff6b6b; --info:#4dabf7; --warn:#ffd43b;
      --font-ui:'Inter',sans-serif; --font-code:'JetBrains Mono',monospace;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{background:var(--bg-deep);color:var(--text-main);font-family:var(--font-ui);height:100vh;display:flex;overflow:hidden}

    /* LAYOUT */
    .sidebar{width:260px;background:var(--bg-sidebar);border-right:1px solid var(--border);display:flex;flex-direction:column;z-index:10;padding:10px}
    .main-wrapper{flex:1;display:flex;flex-direction:column;position:relative;overflow:hidden}
    .top-bar{height:60px;border-bottom:1px solid var(--border);background:var(--bg-sidebar);display:flex;align-items:center;justify-content:space-between;padding:0 25px}
    .content-area{flex:1;overflow-y:auto;padding:28px}

    /* COMPONENTS */
    .brand{padding:15px;font-family:'Playfair Display',serif;font-size:1.4rem;color:#fff;display:flex;align-items:center;gap:10px;margin-bottom:14px}
    .brand i{color:var(--primary)}
    .nav-label{font-size:.7rem;text-transform:uppercase;color:var(--text-muted);font-weight:700;margin:15px 0 6px 10px}
    .nav-item{padding:10px 15px;border-radius:6px;cursor:pointer;display:flex;align-items:center;gap:12px;font-size:.9rem;color:var(--text-muted);margin-bottom:2px;transition:.2s}
    .nav-item:hover,.nav-item.active{background:var(--primary-dim);color:var(--primary);border-left:3px solid var(--primary)}
    .grid-4{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:18px;margin-bottom:18px}
    .card{background:var(--bg-panel);border:1px solid var(--border);border-radius:10px;padding:18px;position:relative;box-shadow:var(--shadow)}
    .card h3{margin-bottom:12px}
    .stat-val{font-size:2rem;font-weight:700;color:#fff;font-family:var(--font-code);margin:10px 0}
    .muted{color:var(--text-muted)}
    .pill{display:inline-flex;align-items:center;gap:6px;padding:5px 10px;border-radius:999px;border:1px solid var(--border);font-size:.78rem;color:#cbd5e1;background:#0f1216}
    .pill.ok{border-color:rgba(81,207,102,.35);color:var(--success)}
    .pill.bad{border-color:rgba(255,107,107,.35);color:var(--danger)}
    .pill.info{border-color:rgba(77,171,247,.35);color:var(--info)}
    .pill.warn{border-color:rgba(255,212,59,.35);color:var(--warn)}

    .btn{background:var(--primary);color:#000;border:none;padding:9px 14px;border-radius:7px;cursor:pointer;font-weight:700;display:inline-flex;align-items:center;gap:8px}
    .btn:hover{background:#fff}
    .btn.secondary{background:transparent;color:var(--text-main);border:1px solid var(--border);font-weight:600}
    .btn.secondary:hover{border-color:rgba(212,175,55,.5);color:var(--primary)}
    .btn:disabled{opacity:.55;cursor:not-allowed}

    .toolbar{display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:space-between;margin-bottom:14px}
    .toolbar-left{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .toolbar-right{display:flex;gap:10px;flex-wrap:wrap;align-items:center}

    .input{
      background:#0f1216;border:1px solid var(--border);color:var(--text-main);
      padding:9px 10px;border-radius:8px;outline:none;min-width:240px
    }
    .select{
      background:#0f1216;border:1px solid var(--border);color:var(--text-main);
      padding:9px 10px;border-radius:8px;outline:none
    }
    .kpi-badge{position:absolute;top:14px;right:14px}
    .split{display:grid;grid-template-columns: 1.2fr .8fr;gap:18px}
    @media(max-width:980px){.split{grid-template-columns:1fr}}

    /* TABLE */
    .data-table{width:100%;border-collapse:collapse;margin-top:8px}
    .data-table th{text-align:left;padding:10px;color:var(--text-muted);border-bottom:1px solid var(--border);font-size:.78rem}
    .data-table td{padding:10px;border-bottom:1px solid #333;color:#d1d5db;font-size:.88rem}
    .tag{font-family:var(--font-code);font-size:.78rem;color:#cbd5e1}
    .td-right{text-align:right}
    .row-actions{display:flex;gap:10px;justify-content:flex-end}
    .icon-btn{background:transparent;border:1px solid var(--border);color:#cbd5e1;border-radius:8px;padding:7px 9px;cursor:pointer}
    .icon-btn:hover{border-color:rgba(212,175,55,.5);color:var(--primary)}
    .empty{padding:18px;color:#777;text-align:center;border:1px dashed #2c3036;border-radius:10px;background:#0f1216}

    /* TOASTS */
    .toasts{position:fixed;bottom:18px;right:18px;z-index:5000;display:flex;flex-direction:column;gap:10px}
    .toast{
      width:min(420px, calc(100vw - 36px));
      background:#0f1216;border:1px solid var(--border);border-left:4px solid var(--info);
      border-radius:10px;padding:12px 12px;box-shadow:var(--shadow);display:flex;gap:10px;align-items:flex-start
    }
    .toast.ok{border-left-color:var(--success)}
    .toast.bad{border-left-color:var(--danger)}
    .toast.warn{border-left-color:var(--warn)}
    .toast .t-title{font-weight:700;margin-bottom:2px}
    .toast .t-msg{color:#cbd5e1;font-size:.9rem}
    .toast .t-close{margin-left:auto;background:transparent;border:none;color:#cbd5e1;cursor:pointer;font-size:1.1rem}
    .toast .t-close:hover{color:#fff}

    /* MODAL SIM */
    .sim-overlay{position:fixed;inset:0;background:rgba(0,0,0,.9);z-index:2000;display:none;justify-content:center;align-items:center;backdrop-filter:blur(5px)}
    .sim-overlay.active{display:flex}
    .sim-box{width:92vw;height:86vh;background:#0f0f0f;border:1px solid var(--border);border-radius:12px;display:flex;flex-direction:column;box-shadow:0 0 50px rgba(0,0,0,.5);overflow:hidden}
    .sim-header{height:60px;background:#161b22;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;padding:0 20px}
    .sim-body{flex:1;display:flex;overflow:hidden}
    .sim-stage{flex:3;background:#0b0c10;position:relative;display:flex;flex-direction:column;align-items:center;justify-content:center;border-right:1px solid var(--border);overflow:hidden;padding:20px}
    .sim-terminal{flex:2;background:#050505;padding:18px;font-family:var(--font-code);font-size:.83rem;color:#33ff00;overflow-y:auto;border-left:1px solid #333;display:flex;flex-direction:column}
    .term-line{margin-bottom:6px;opacity:0;animation:slideIn .2s forwards;display:flex;gap:10px;align-items:flex-start}
    .term-time{color:#555;white-space:nowrap}
    .term-text{color:#ddd}
    .term-highlight{color:var(--primary)}
    @keyframes slideIn{from{transform:translateX(10px);opacity:0}to{transform:translateX(0);opacity:1}}
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}
    @keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.05)}100%{transform:scale(1)}}

    .stage-container{text-align:center;animation:fadeIn .45s;width:100%;max-width:560px}
    .visual-icon{font-size:4rem;margin-bottom:14px;color:var(--text-muted);transition:.5s}
    .visual-icon.active{color:var(--primary);transform:scale(1.15);text-shadow:0 0 20px var(--primary)}
    .visual-card{background:#1f242c;padding:18px;border-radius:10px;border:1px solid #333;text-align:left;margin:0 auto;position:relative;box-shadow:0 10px 30px rgba(0,0,0,.5);transition:.5s}
    .visual-card.approved{border-color:var(--success);box-shadow:0 0 20px rgba(81,207,102,.2)}
    .visual-card.alert{border-color:var(--danger);box-shadow:0 0 20px rgba(255,107,107,.2)}
    .progress-bar{width:100%;height:6px;background:#333;border-radius:3px;margin-top:14px;overflow:hidden}
    .progress-fill{height:100%;background:var(--info);width:0%;transition:width 1s}
    .float-badge{position:absolute;top:-10px;right:-10px;background:var(--success);color:#000;padding:5px 10px;border-radius:20px;font-weight:800;font-size:.8rem;opacity:0;transform:translateY(10px);transition:.3s}
    .float-badge.show{opacity:1;transform:translateY(0)}

    /* SECTIONS */
    .view-section{display:none;animation:fadeIn .35s}
    .view-section.active{display:block}

    /* small helper */
    .mono{font-family:var(--font-code)}
    .hr{height:1px;background:var(--border);margin:14px 0}
  </style>
</head>

<body>
  <aside class="sidebar">
    <div class="brand">
      <i class="fas fa-cube"></i> NetMarket
      <span style="font-size:0.6rem;border:1px solid var(--primary);padding:2px 6px;border-radius:6px;margin-left:5px;">V8</span>
    </div>

    <div class="nav-label">Général</div>
    <div class="nav-item active" onclick="nav('dashboard', this)"><i class="fas fa-th-large"></i> Dashboard</div>

    <div class="nav-label">Outils Métiers</div>
    <div class="nav-item" onclick="nav('design', this)"><i class="fas fa-pencil-ruler"></i> NetDesignX</div>
    <div class="nav-item" onclick="nav('cat', this)"><i class="fas fa-tags"></i> NetCatX</div>
    <div class="nav-item" onclick="nav('promo', this)"><i class="fas fa-bullhorn"></i> NetPromoX</div>
    <div class="nav-item" onclick="nav('care', this)"><i class="fas fa-headset"></i> NetCareX</div>

    <div class="nav-label">Ops</div>
    <div class="nav-item" onclick="nav('ops', this)"><i class="fas fa-shield-halved"></i> Audit & Conformité</div>

    <div style="margin-top:auto;font-size:.78rem;color:#555;padding:10px;">
      System Status: <span style="color:var(--success)">● Online</span><br>
      Server: AWS-Paris-1<br>
      Build: <span class="mono">titan-v8.3.2</span>
    </div>
  </aside>

  <div class="main-wrapper">
    <header class="top-bar">
      <div style="font-weight:700" id="pageTitle">Dashboard</div>
      <div style="display:flex;align-items:center;gap:10px;">
        <span style="font-size:.85rem;color:var(--text-muted);" id="clock">--:--:--</span>
        <span class="pill info"><i class="fas fa-bolt"></i> Mode Démo</span>
        <span style="font-size:.85rem;color:var(--text-muted);">Admin User</span>
        <div style="width:30px;height:30px;background:var(--primary);border-radius:50%;display:flex;align-items:center;justify-content:center;color:#000;font-weight:900;">A</div>
      </div>
    </header>

    <div class="content-area">
      <!-- DASHBOARD -->
      <section id="dashboard" class="view-section active">
        <div class="toolbar">
          <div class="toolbar-left">
            <span class="pill ok"><i class="fas fa-heart-pulse"></i> Uptime 99.98%</span>
            <span class="pill info"><i class="fas fa-arrows-rotate"></i> Sync 2m</span>
            <span class="pill warn"><i class="fas fa-triangle-exclamation"></i> 1 alerte</span>
          </div>
          <div class="toolbar-right">
            <button class="btn secondary" onclick="exportLogsCSV()"><i class="fas fa-file-export"></i> Export Logs</button>
            <button class="btn" onclick="toast('ok','Snapshot','Rapport KPI généré (démo).')"><i class="fas fa-camera"></i> Snapshot</button>
          </div>
        </div>

        <h2 style="margin-bottom:14px;color:#fff;">Vue d'Ensemble</h2>

        <div class="grid-4">
          <div class="card">
            <div class="kpi-badge pill info"><i class="fas fa-chart-simple"></i> KPI</div>
            <div class="muted" style="font-size:.9rem;">Chiffre d'Affaires</div>
            <div class="stat-val" id="kpiCA">11.1 Mds</div>
            <div style="color:var(--success);font-size:.82rem;">▲ +7% Annuel</div>
          </div>
          <div class="card">
            <div class="kpi-badge pill info"><i class="fas fa-user-group"></i> Live</div>
            <div class="muted" style="font-size:.9rem;">Visiteurs Actifs</div>
            <div class="stat-val" id="kpiVisitors">45,200</div>
            <div style="color:var(--success);font-size:.82rem;">▲ +12% vs Hier</div>
          </div>
          <div class="card">
            <div class="kpi-badge pill info"><i class="fas fa-bag-shopping"></i> Ops</div>
            <div class="muted" style="font-size:.9rem;">Commandes / Jour</div>
            <div class="stat-val" id="kpiOrders">8,450</div>
            <div style="color:var(--info);font-size:.82rem;">● Stable</div>
          </div>
          <div class="card">
            <div class="kpi-badge pill warn"><i class="fas fa-rotate-left"></i> Qualité</div>
            <div class="muted" style="font-size:.9rem;">Taux Retour</div>
            <div class="stat-val" id="kpiReturns">14%</div>
            <div style="color:var(--danger);font-size:.82rem;">▼ -2% (Objectif)</div>
          </div>
        </div>

        <div class="split">
          <div class="card">
            <div class="toolbar" style="margin-bottom:6px;">
              <div class="toolbar-left">
                <h3 style="margin:0;">Flux d'Activité (Logs)</h3>
                <span class="pill info"><i class="fas fa-database"></i> Event Stream</span>
              </div>
              <div class="toolbar-right">
                <input class="input" id="logSearch" placeholder="Rechercher: module, action, détail..." oninput="renderLogs()" />
                <select class="select" id="logFilter" onchange="renderLogs()">
                  <option value="ALL">Tous modules</option>
                  <option value="NetDesignX">NetDesignX</option>
                  <option value="NetCatX">NetCatX</option>
                  <option value="NetPromoX">NetPromoX</option>
                  <option value="NetCareX">NetCareX</option>
                  <option value="OPS">OPS</option>
                </select>
              </div>
            </div>

            <table class="data-table">
              <thead>
                <tr>
                  <th>Horodatage</th><th>Module</th><th>Action</th><th>Détail</th><th class="td-right">Statut</th>
                </tr>
              </thead>
              <tbody id="logsBody"></tbody>
            </table>
          </div>

          <div class="card">
            <h3>KPIs Opérationnels</h3>
            <div class="hr"></div>
            <div style="display:grid;gap:12px;">
              <div>
                <div class="muted">Temps de cycle moyen</div>
                <div class="mono" style="font-size:1.3rem;font-weight:800;color:#fff" id="kpiCycle">—</div>
              </div>
              <div>
                <div class="muted">Taux d'erreur PIM</div>
                <div class="mono" style="font-size:1.3rem;font-weight:800;color:#fff" id="kpiPimErr">—</div>
              </div>
              <div>
                <div class="muted">SLA Support (24h)</div>
                <div class="mono" style="font-size:1.3rem;font-weight:800;color:#fff" id="kpiSLA">—</div>
              </div>
              <div>
                <div class="muted">ROI Marketing (7j)</div>
                <div class="mono" style="font-size:1.3rem;font-weight:800;color:#fff" id="kpiROI">—</div>
              </div>
            </div>
            <div class="hr"></div>
            <button class="btn" onclick="recalcKPIs()"><i class="fas fa-wand-magic-sparkles"></i> Recalculer KPIs</button>
          </div>
        </div>
      </section>

      <!-- DESIGN -->
      <section id="design" class="view-section">
        <div class="toolbar">
          <div class="toolbar-left">
            <h2 style="margin:0;">NetDesignX <span style="color:#666;font-size:1rem;">| Création</span></h2>
            <span class="pill info"><i class="fas fa-diagram-project"></i> Workflow</span>
          </div>
          <div class="toolbar-right">
            <button class="btn secondary" onclick="toast('info','Brief','Brief produit généré (démo).')"><i class="fas fa-clipboard"></i> Générer Brief</button>
            <button class="btn" onclick="startSim('design')"><i class="fas fa-play"></i> Simuler Workflow</button>
          </div>
        </div>

        <div class="grid-4">
          <div class="card"><div class="muted">Idées</div><div class="stat-val" id="dIdeas">42</div><span class="pill ok">Backlog sain</span></div>
          <div class="card"><div class="muted">Prototypes 3D</div><div class="stat-val" id="dProto">15</div><span class="pill info">CLO3D</span></div>
          <div class="card"><div class="muted">Temps de validation</div><div class="stat-val" id="dLead">3.2 j</div><span class="pill warn">À optimiser</span></div>
          <div class="card"><div class="muted">Coût moyen proto</div><div class="stat-val" id="dCost">12.5€</div><span class="pill ok">Sous contrôle</span></div>
        </div>

        <div class="card">
          <div class="toolbar">
            <div class="toolbar-left">
              <h3 style="margin:0;">Pipeline Créatif</h3>
              <span class="pill info"><i class="fas fa-layer-group"></i> Kanban</span>
            </div>
            <div class="toolbar-right">
              <button class="btn secondary" onclick="toast('ok','Sync','Assets synchronisés vers NetCatX.')"><i class="fas fa-cloud-arrow-up"></i> Sync PIM</button>
            </div>
          </div>

          <div style="display:flex;gap:10px;margin-top:10px;flex-wrap:wrap;">
            <div style="flex:1;min-width:240px;background:#252a30;padding:15px;border-radius:10px;border:1px solid #2b3036;">
              <div style="font-weight:900;margin-bottom:10px;color:var(--info);">TO DO</div>
              <div style="background:#333;padding:10px;margin-bottom:7px;border-radius:8px;">Veste Hiver</div>
              <div style="background:#333;padding:10px;border-radius:8px;">Robe Soie</div>
            </div>
            <div style="flex:1;min-width:240px;background:#252a30;padding:15px;border-radius:10px;border:1px solid #2b3036;">
              <div style="font-weight:900;margin-bottom:10px;color:var(--primary);">IN PROGRESS</div>
              <div style="background:#333;padding:10px;border-radius:8px;">Pantalon Cargo (CLO3D)</div>
            </div>
            <div style="flex:1;min-width:240px;background:#252a30;padding:15px;border-radius:10px;border:1px solid #2b3036;">
              <div style="font-weight:900;margin-bottom:10px;color:var(--success);">DONE</div>
              <div style="background:#333;padding:10px;border-radius:8px;border-left:3px solid var(--success);">Sneakers RunX</div>
            </div>
          </div>
        </div>
      </section>

      <!-- PROMO -->
      <section id="promo" class="view-section">
        <div class="toolbar">
          <div class="toolbar-left">
            <h2 style="margin:0;">NetPromoX <span style="color:#666;font-size:1rem;">| Marketing</span></h2>
            <span class="pill info"><i class="fas fa-bullseye"></i> Campagnes</span>
          </div>
          <div class="toolbar-right">
            <select class="select" id="segmentSelect" onchange="updateSegment()">
              <option value="VIP">Segment VIP (>200€)</option>
              <option value="NEW">Nouveaux clients (30j)</option>
              <option value="CHURN">Risque churn (90j)</option>
            </select>
            <button class="btn secondary" onclick="toast('info','A/B Test','2 variantes de sujet prêtes (démo).')"><i class="fas fa-flask"></i> A/B Test</button>
            <button class="btn" onclick="startSim('promo')"><i class="fas fa-play"></i> Simuler Campagne</button>
          </div>
        </div>

        <div class="grid-4">
          <div class="card"><div class="muted">Emails Envoyés</div><div class="stat-val" id="pSent">120k</div><span class="pill info">SMTP batch</span></div>
          <div class="card"><div class="muted">ROI Global</div><div class="stat-val" style="color:var(--success);" id="pROI">5.2x</div><span class="pill ok">Rentable</span></div>
          <div class="card"><div class="muted">Taux ouverture</div><div class="stat-val" id="pOpen">32%</div><span class="pill ok">Au-dessus médiane</span></div>
          <div class="card"><div class="muted">Désinscriptions</div><div class="stat-val" id="pUnsub">0.18%</div><span class="pill warn">À surveiller</span></div>
        </div>

        <div class="card" style="height:320px;">
          <canvas id="chartPromo"></canvas>
        </div>
      </section>

      <!-- CAT -->
      <section id="cat" class="view-section">
        <div class="toolbar">
          <div class="toolbar-left">
            <h2 style="margin:0;">NetCatX <span style="color:#666;font-size:1rem;">| PIM</span></h2>
            <span class="pill info"><i class="fas fa-tags"></i> Data Quality</span>
          </div>
          <div class="toolbar-right">
            <button class="btn secondary" onclick="toast('info','Import','Import ERP simulé: 150 SKU.')"><i class="fas fa-file-import"></i> Import ERP</button>
            <button class="btn" onclick="startSim('cat')"><i class="fas fa-play"></i> Simuler Flux</button>
          </div>
        </div>

        <div class="grid-4">
          <div class="card"><div class="muted">Produits Live</div><div class="stat-val" id="cLive">12,400</div><span class="pill ok">Stable</span></div>
          <div class="card"><div class="muted">Erreurs</div><div class="stat-val" style="color:var(--success);" id="cErr">0</div><span class="pill ok">Zéro défaut</span></div>
          <div class="card"><div class="muted">Complétude</div><div class="stat-val" id="cComp">98.7%</div><span class="pill ok">Très bon</span></div>
          <div class="card"><div class="muted">Temps publication</div><div class="stat-val" id="cPub">14 min</div><span class="pill info">Pipeline API</span></div>
        </div>

        <div class="card">
          <div class="toolbar">
            <div class="toolbar-left">
              <h3 style="margin:0;">Contrôles Qualité (démo)</h3>
              <span class="pill warn"><i class="fas fa-shield"></i> Règles</span>
            </div>
            <div class="toolbar-right">
              <button class="btn secondary" onclick="runQualityChecks()"><i class="fas fa-play"></i> Exécuter</button>
            </div>
          </div>
          <div id="qcOut" class="empty">Clique sur “Exécuter” pour lancer les règles (prix, stocks, visuels, SEO).</div>
        </div>
      </section>

      <!-- CARE -->
      <section id="care" class="view-section">
        <div class="toolbar">
          <div class="toolbar-left">
            <h2 style="margin:0;">NetCareX <span style="color:#666;font-size:1rem;">| Support</span></h2>
            <span class="pill info"><i class="fas fa-headset"></i> SLA</span>
          </div>
          <div class="toolbar-right">
            <button class="btn secondary" onclick="toast('info','Macros','Templates réponses chargés (démo).')"><i class="fas fa-wand-magic"></i> Macros</button>
            <button class="btn" onclick="startSim('care')"><i class="fas fa-play"></i> Simuler Ticket</button>
          </div>
        </div>

        <div class="grid-4">
          <div class="card"><div class="muted">Tickets Ouverts</div><div class="stat-val" id="sOpen">24</div><span class="pill warn">File active</span></div>
          <div class="card"><div class="muted">Satisfaction</div><div class="stat-val" style="color:var(--primary);" id="sCSAT">4.8/5</div><span class="pill ok">Top</span></div>
          <div class="card"><div class="muted">SLA <span class="mono">(24h)</span></div><div class="stat-val" id="sSLA">92%</div><span class="pill warn">À remonter</span></div>
          <div class="card"><div class="muted">Temps 1ère réponse</div><div class="stat-val" id="sFRT">1h 12m</div><span class="pill ok">Correct</span></div>
        </div>

        <div class="card">
          <h3>File Tickets (démo)</h3>
          <table class="data-table">
            <thead>
              <tr><th>ID</th><th>Client</th><th>Motif</th><th>Priorité</th><th class="td-right">Actions</th></tr>
            </thead>
            <tbody id="ticketsBody"></tbody>
          </table>
        </div>
      </section>

      <!-- OPS -->
      <section id="ops" class="view-section">
        <div class="toolbar">
          <div class="toolbar-left">
            <h2 style="margin:0;">Audit & Conformité</h2>
            <span class="pill info"><i class="fas fa-shield-halved"></i> Audit Trail</span>
          </div>
          <div class="toolbar-right">
            <button class="btn secondary" onclick="exportAuditCSV()"><i class="fas fa-file-export"></i> Export Audit</button>
            <button class="btn" onclick="toast('ok','Conformité','Contrôles OK (démo).')"><i class="fas fa-check"></i> Run Checks</button>
          </div>
        </div>

        <div class="card">
          <h3>Journal d'audit (démo)</h3>
          <div class="muted" style="margin-bottom:10px;">Qui a fait quoi, quand, et sur quel module (utile pour ton rapport).</div>
          <table class="data-table">
            <thead><tr><th>Date</th><th>Utilisateur</th><th>Module</th><th>Action</th><th>Détail</th><th class="td-right">Niveau</th></tr></thead>
            <tbody id="auditBody"></tbody>
          </table>
        </div>
      </section>
    </div>
  </div>

  <!-- SIM MODAL -->
  <div id="simModal" class="sim-overlay">
    <div class="sim-box">
      <div class="sim-header">
        <div style="font-family:var(--font-code);font-size:1.05rem;color:var(--primary);">
          <i class="fas fa-terminal"></i> SIMULATION: <span id="simTitle">...</span>
        </div>
        <button onclick="closeSim()" style="background:none;border:none;color:#fff;font-size:1.6rem;cursor:pointer;">&times;</button>
      </div>
      <div class="sim-body">
        <div class="sim-stage" id="stage">
          <div style="color:#666;">En attente...</div>
        </div>
        <div class="sim-terminal" id="terminal">
          <div>> System Ready.</div>
        </div>
      </div>
      <div style="padding:16px;background:#111;text-align:center;border-top:1px solid #333;display:flex;gap:10px;justify-content:center;flex-wrap:wrap;">
        <button class="btn secondary" onclick="toggleSpeed()"><i class="fas fa-gauge-high"></i> Vitesse: <span id="speedLbl">x1</span></button>
        <button class="btn" id="btnRun" onclick="runSequence()"><i class="fas fa-bolt"></i> EXECUTER SEQUENCE</button>
      </div>
    </div>
  </div>

  <!-- TOASTS -->
  <div class="toasts" id="toasts"></div>

  <script>
    /* =========================
       CLOCK
    ========================= */
    setInterval(()=> {
      document.getElementById('clock').innerText = new Date().toLocaleTimeString();
    }, 500);

    /* =========================
       CHARTS
    ========================= */
    const ctxPromo = document.getElementById('chartPromo').getContext('2d');
    const promoChart = new Chart(ctxPromo, {
      type: 'line',
      data: {
        labels: ['L', 'M', 'M', 'J', 'V', 'S', 'D'],
        datasets: [{
          label: 'Ventes Campagne (€)',
          data: [1200, 1900, 3000, 5000, 4200, 6000, 7000],
          borderColor: '#d4af37',
          backgroundColor: 'rgba(212, 175, 55, 0.1)',
          fill: true,
          tension: .35
        }]
      },
      options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { ticks: { color: '#777' } }, x: { ticks: { color: '#777' } } } }
    });

    function updateSegment(){
      const seg = document.getElementById('segmentSelect').value;
      if(seg==='VIP'){
        setText('pSent','120k'); setText('pROI','5.2x'); setText('pOpen','32%'); setText('pUnsub','0.18%');
        promoChart.data.datasets[0].data = [1200,1900,3000,5000,4200,6000,7000];
      } else if(seg==='NEW'){
        setText('pSent','75k'); setText('pROI','3.1x'); setText('pOpen','38%'); setText('pUnsub','0.22%');
        promoChart.data.datasets[0].data = [900,1400,2300,3400,3100,4200,4800];
      } else {
        setText('pSent','40k'); setText('pROI','2.4x'); setText('pOpen','26%'); setText('pUnsub','0.11%');
        promoChart.data.datasets[0].data = [700,1100,1700,2100,2400,2600,2800];
      }
      promoChart.update();
      toast('info','Segment',`Segment actif: ${seg}`);
      audit('Admin','NetPromoX','UPDATE_SEGMENT',`Segment=${seg}`,'INFO');
    }

    /* =========================
       NAV
    ========================= */
    function nav(id, el) {
      document.querySelectorAll('.view-section').forEach(s => s.classList.remove('active'));
      document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      el.classList.add('active');
      document.getElementById('pageTitle').innerText = id.charAt(0).toUpperCase() + id.slice(1);

      audit('Admin', id==='ops'?'OPS':(
        id==='dashboard'?'OPS':
        id==='design'?'NetDesignX':
        id==='cat'?'NetCatX':
        id==='promo'?'NetPromoX':
        id==='care'?'NetCareX':'OPS'
      ), 'NAVIGATE', `to=${id}`, 'INFO');
    }

    /* =========================
       UTIL
    ========================= */
    function setText(id, v){ document.getElementById(id).innerText = v; }
    function fmt(n){ return n.toLocaleString('fr-CH'); }
    function rand(a,b){ return Math.floor(Math.random()*(b-a+1))+a; }
    function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

    /* =========================
       TOASTS
    ========================= */
    function toast(type, title, msg){
      const host = document.getElementById('toasts');
      const el = document.createElement('div');
      el.className = 'toast ' + (type||'info');
      el.innerHTML = `
        <div>
          <div class="t-title">${title}</div>
          <div class="t-msg">${msg}</div>
        </div>
        <button class="t-close" aria-label="close">&times;</button>
      `;
      el.querySelector('.t-close').onclick = ()=> el.remove();
      host.appendChild(el);
      setTimeout(()=> { if(el.isConnected) el.remove(); }, 4200);
    }

    /* =========================
       LOGS (enrichis + filtres)
    ========================= */
    const logsSeed = [
      {mod:'NetCatX', act:'Sync Shopify', det:'150 items', status:'OK'},
      {mod:'NetPromoX', act:'Email Sent', det:'Segment VIP', status:'OK'},
      {mod:'NetCareX', act:'Ticket Closed', det:'Refund #882', status:'OK'},
      {mod:'NetDesignX', act:'3D Render', det:'Veste Hiver', status:'OK'},
      {mod:'OPS', act:'Policy Check', det:'GDPR consent OK', status:'OK'},
      {mod:'NetCatX', act:'Rule Engine', det:'SEO title missing (SKU BST-2025)', status:'WARN'}
    ];

    const logs = [];
    function pushLog(mod, act, det, status='OK'){
      logs.unshift({ts: new Date(), mod, act, det, status});
      if(logs.length>60) logs.pop();
      renderLogs();
    }

    function renderLogs(){
      const q = (document.getElementById('logSearch').value||'').toLowerCase();
      const f = document.getElementById('logFilter').value;

      const rows = logs
        .filter(l => (f==='ALL' || l.mod===f))
        .filter(l => (`${l.mod} ${l.act} ${l.det}`.toLowerCase().includes(q)));

      const body = document.getElementById('logsBody');
      body.innerHTML = rows.slice(0,10).map(l=>{
        const st = l.status==='OK'
          ? `<span class="pill ok">OK</span>`
          : l.status==='WARN'
            ? `<span class="pill warn">WARN</span>`
            : `<span class="pill bad">FAIL</span>`;
        return `
          <tr>
            <td class="tag">${l.ts.toLocaleTimeString()}</td>
            <td><span style="color:var(--primary)">${l.mod}</span></td>
            <td>${l.act}</td>
            <td>${l.det}</td>
            <td class="td-right">${st}</td>
          </tr>`;
      }).join('');

      if(rows.length===0){
        body.innerHTML = `<tr><td colspan="5"><div class="empty">Aucun résultat (démo calme, pour une fois).</div></td></tr>`;
      }
    }

    // initial logs
    for(let i=0;i<10;i++){
      const s = pick(logsSeed);
      pushLog(s.mod, s.act, s.det, s.status);
    }

    setInterval(()=>{
      const s = pick(logsSeed);
      // petit "live" : modifie un peu les détails
      let det = s.det;
      if(s.mod==='NetCatX' && s.act==='Sync Shopify') det = `${rand(80,260)} items`;
      if(s.mod==='NetPromoX' && s.act==='Email Sent') det = `Batch ${fmt(rand(10_000, 55_000))}`;
      if(s.mod==='NetCareX' && s.act==='Ticket Closed') det = `Ticket #${rand(800,999)}`;
      pushLog(s.mod, s.act, det, s.status);
    }, 3200);

    function exportLogsCSV(){
      const header = ['timestamp','module','action','detail','status'];
      const lines = [header.join(',')].concat(
        logs.map(l => [
          l.ts.toISOString(),
          `"${l.mod}"`,
          `"${l.act}"`,
          `"${String(l.det).replaceAll('"','""')}"`,
          l.status
        ].join(','))
      );
      downloadFile('netmarket_logs.csv', lines.join('\n'));
      toast('ok','Export','CSV téléchargé: netmarket_logs.csv');
      audit('Admin','OPS','EXPORT','logs=csv','INFO');
    }

    function downloadFile(filename, text){
      const blob = new Blob([text], {type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = filename; a.click();
      URL.revokeObjectURL(url);
    }

    /* =========================
       KPI ENGINE (démo)
    ========================= */
    function recalcKPIs(){
      // Petits modèles plausibles (démo) : on calcule à partir de quelques variables.
      const cycleMin = rand(8, 22);               // min
      const pimErr = (Math.random()*0.35).toFixed(2); // %
      const sla = rand(88, 97);                   // %
      const roi = (2 + Math.random()*4).toFixed(1);   // x

      setText('kpiCycle', `${cycleMin} min`);
      setText('kpiPimErr', `${pimErr}%`);
      setText('kpiSLA', `${sla}%`);
      setText('kpiROI', `${roi}x`);

      toast('info','KPIs','KPIs recalculés (démo).');
      audit('Admin','OPS','KPI_RECALC',`cycle=${cycleMin}min, pimErr=${pimErr}%, sla=${sla}%, roi=${roi}x`,'INFO');
    }
    recalcKPIs();

    /* =========================
       TICKETS (Support)
    ========================= */
    const tickets = [
      {id:'#1042', client:'Julie M.', motif:'Retour - taille', prio:'Haute'},
      {id:'#1043', client:'Karim S.', motif:'Livraison en retard', prio:'Moyenne'},
      {id:'#1044', client:'Emma R.', motif:'Facturation', prio:'Basse'},
      {id:'#1045', client:'Noah L.', motif:'Produit défectueux', prio:'Haute'}
    ];
    function renderTickets(){
      const body = document.getElementById('ticketsBody');
      body.innerHTML = tickets.map(t=>{
        const p = t.prio==='Haute' ? 'warn' : (t.prio==='Moyenne'?'info':'ok');
        return `
          <tr>
            <td class="tag">${t.id}</td>
            <td>${t.client}</td>
            <td>${t.motif}</td>
            <td><span class="pill ${p}">${t.prio}</span></td>
            <td class="td-right">
              <div class="row-actions">
                <button class="icon-btn" onclick="autoReply('${t.id}')"><i class="fas fa-wand-magic-sparkles"></i></button>
                <button class="icon-btn" onclick="closeTicket('${t.id}')"><i class="fas fa-check"></i></button>
              </div>
            </td>
          </tr>`;
      }).join('');
    }
    renderTickets();

    function autoReply(id){
      toast('info','Réponse IA',`Proposition générée pour ${id} (démo).`);
      pushLog('NetCareX','AI Draft',`Draft for ${id}`,'OK');
      audit('Admin','NetCareX','AI_DRAFT',`ticket=${id}`,'INFO');
    }
    function closeTicket(id){
      const i = tickets.findIndex(t=>t.id===id);
      if(i>=0) tickets.splice(i,1);
      renderTickets();
      toast('ok','Ticket',`${id} clos.`);
      pushLog('NetCareX','Ticket Closed',`${id}`,'OK');
      audit('Admin','NetCareX','CLOSE_TICKET',`ticket=${id}`,'INFO');

      // update mini KPIs support
      const open = Math.max(0, parseInt(document.getElementById('sOpen').innerText,10)-1);
      setText('sOpen', String(open));
      const sla = Math.min(99, rand(90,96));
      setText('sSLA', `${sla}%`);
    }

    /* =========================
       QUALITY CHECKS (PIM)
    ========================= */
    function runQualityChecks(){
      const checks = [
        {name:'Prix > 0', ok:true},
        {name:'Stock cohérent (>=0)', ok:true},
        {name:'Visuels (>=3)', ok: Math.random()>.15},
        {name:'SEO title present', ok: Math.random()>.25},
        {name:'Tailles / variantes', ok:true}
      ];
      const fails = checks.filter(c=>!c.ok).length;
      const html = `
        <div style="display:grid;gap:10px;">
          ${checks.map(c=>`
            <div class="pill ${c.ok?'ok':'bad'}" style="justify-content:space-between;">
              <span><i class="fas ${c.ok?'fa-check':'fa-xmark'}"></i> ${c.name}</span>
              <span>${c.ok?'PASS':'FAIL'}</span>
            </div>
          `).join('')}
          <div class="hr"></div>
          <div class="mono" style="color:#fff;font-weight:800;">
            Résultat: ${fails===0 ? '<span style="color:var(--success)">OK</span>' : '<span style="color:var(--danger)">KO</span>'}
            <span class="muted" style="font-family:var(--font-ui);font-weight:500;">(${fails} échec(s))</span>
          </div>
        </div>
      `;
      const out = document.getElementById('qcOut');
      out.className = 'card';
      out.style.background = '#0f1216';
      out.style.border = '1px solid var(--border)';
      out.innerHTML = html;

      if(fails===0){
        toast('ok','Qualité PIM','Toutes les règles passent.');
        pushLog('NetCatX','Rule Engine','All checks PASS','OK');
      } else {
        toast('warn','Qualité PIM',`${fails} règle(s) en échec — correction requise.`);
        pushLog('NetCatX','Rule Engine',`${fails} check(s) FAIL`,'WARN');
      }
      audit('Admin','NetCatX','QUALITY_CHECK',`fails=${fails}`,(fails===0?'INFO':'WARN'));

      // update KPI "erreurs"
      setText('cErr', String(fails));
      setText('kpiPimErr', `${(fails*0.12).toFixed(2)}%`);
    }

    /* =========================
       AUDIT TRAIL (OPS)
    ========================= */
    const auditEvents = [];
    function audit(user, module, action, detail, level){
      auditEvents.unshift({ts:new Date(), user, module, action, detail, level});
      if(auditEvents.length>50) auditEvents.pop();
      renderAudit();
    }

    function renderAudit(){
      const body = document.getElementById('auditBody');
      body.innerHTML = auditEvents.slice(0,12).map(a=>{
        const pill = a.level==='WARN' ? 'warn' : (a.level==='ERROR'?'bad':'info');
        return `
          <tr>
            <td class="tag">${a.ts.toLocaleString()}</td>
            <td>${a.user}</td>
            <td><span style="color:var(--primary)">${a.module}</span></td>
            <td class="tag">${a.action}</td>
            <td>${a.detail}</td>
            <td class="td-right"><span class="pill ${pill}">${a.level}</span></td>
          </tr>`;
      }).join('');
      if(auditEvents.length===0){
        body.innerHTML = `<tr><td colspan="6"><div class="empty">Aucun événement (c’est louche… mais c’est propre).</div></td></tr>`;
      }
    }

    function exportAuditCSV(){
      const header = ['timestamp','user','module','action','detail','level'];
      const lines = [header.join(',')].concat(
        auditEvents.map(a => [
          a.ts.toISOString(),
          `"${a.user}"`,
          `"${a.module}"`,
          `"${a.action}"`,
          `"${String(a.detail).replaceAll('"','""')}"`,
          a.level
        ].join(','))
      );
      downloadFile('netmarket_audit.csv', lines.join('\n'));
      toast('ok','Export','CSV téléchargé: netmarket_audit.csv');
    }

    /* =========================
       SIMULATION (avec KPIs en sortie)
    ========================= */
    const scenarios = {
      design: {
        title: 'NetDesignX: Création Produit',
        kpis: { cycleMin:[18,42], cost:[9,19], handoff:'NetCatX' },
        steps: [
          {
            html: `<div class="stage-container">
                    <i class="fas fa-pencil-alt visual-icon active"></i>
                    <h3>Import Croquis</h3>
                    <div class="visual-card">
                      <div style="display:flex;justify-content:space-between;">
                        <span>Sketch_v1.pdf</span><i class="fas fa-file-pdf"></i>
                      </div>
                      <div class="progress-bar"><div class="progress-fill" style="width:100%"></div></div>
                    </div>
                  </div>`,
            log: "TRIGGER: New File Upload (Sketch_v1.pdf)"
          },
          {
            html: `<div class="stage-container">
                    <i class="fas fa-cube visual-icon active" style="color:var(--info)"></i>
                    <h3>Génération 3D (CLO)</h3>
                    <div class="visual-card" style="text-align:center;">
                      <i class="fas fa-tshirt fa-3x" style="color:#555; animation:pulse 1s infinite"></i>
                      <p style="margin-top:10px">Rendering Mesh...</p>
                    </div>
                  </div>`,
            log: "PROCESS: CLO3D API > Render Assets..."
          },
          {
            html: `<div class="stage-container">
                    <i class="fas fa-check-circle visual-icon active" style="color:var(--success)"></i>
                    <h3>Validation</h3>
                    <div class="visual-card approved">
                      <strong>Statut:</strong> VALIDÉ<br>
                      <strong>Contrôle:</strong> Patronage + matière OK
                      <div class="float-badge show">Envoyé au Catalogue</div>
                    </div>
                  </div>`,
            log: "SUCCESS: Handoff to NetCatX (PIM) completed."
          }
        ]
      },

      promo: {
        title: 'NetPromoX: Campagne Automatique',
        kpis: { roi:[2.0,6.5], open:[18,42], revenue:[6000,18000] },
        steps: [
          {
            html: `<div class="stage-container">
                    <i class="fas fa-filter visual-icon active"></i>
                    <h3>Segmentation</h3>
                    <div class="visual-card">
                      Filtre: <strong>Clients VIP (&gt;200€)</strong><br>
                      Résultat: <span class="mono">${fmt(rand(18000, 52000))}</span> contacts
                    </div>
                  </div>`,
            log: "QUERY: Select Users WHERE spend > 200..."
          },
          {
            html: `<div class="stage-container">
                    <i class="fas fa-paper-plane visual-icon active" style="color:var(--info)"></i>
                    <h3>Envoi Email</h3>
                    <div class="visual-card">
                      <strong>Sujet:</strong> Vente Privée<br>
                      <strong>Statut:</strong> Sending...
                      <div class="progress-bar"><div class="progress-fill" style="width:70%"></div></div>
                    </div>
                  </div>`,
            log: "SMTP: Batch sending (emails)..."
          },
          {
            html: `<div class="stage-container">
                    <i class="fas fa-chart-line visual-icon active" style="color:var(--success)"></i>
                    <h3>Résultats Live</h3>
                    <div class="visual-card approved">
                      <strong>Tracking:</strong> UTM OK<br>
                      <strong>Attribution:</strong> 7j
                      <div class="float-badge show">ROI POSITIF</div>
                    </div>
                  </div>`,
            log: "TRACKING: Campaign Active. ROI threshold reached."
          }
        ]
      },

      cat: {
        title: 'NetCatX: Enrichissement Produit',
        kpis: { pimErr:[0,1], publishMin:[8,22], completeness:[96.0,99.5] },
        steps: [
          {
            html: `<div class="stage-container">
                    <i class="fas fa-database visual-icon active"></i>
                    <h3>Source ERP</h3>
                    <div class="visual-card">
                      <span class="mono">SKU: BST-2025<br>Price: 120.00<br>Stock: 36</span>
                    </div>
                  </div>`,
            log: "WATCH: ERP Table Update detected."
          },
          {
            html: `<div class="stage-container">
                    <i class="fas fa-magic visual-icon active" style="color:purple"></i>
                    <h3>IA Rédaction</h3>
                    <div class="visual-card">
                      Generating description...<br>
                      <span style="color:#888;">“Découvrez notre veste hiver...”</span>
                    </div>
                  </div>`,
            log: "AI: Generating Description (FR/EN)..."
          },
          {
            html: `<div class="stage-container">
                    <i class="fab fa-shopify visual-icon active" style="color:var(--success)"></i>
                    <h3>Mise en Ligne</h3>
                    <div class="visual-card approved">
                      <strong>Shopify:</strong> Published<br>
                      <strong>Amazon:</strong> Pending
                    </div>
                  </div>`,
            log: "SYNC: Push to Shopify API (200 OK)."
          }
        ]
      },

      care: {
        title: 'NetCareX: Gestion Ticket IA',
        kpis: { sla:[86,97], frtMin:[12,140], csat:[4.2,4.95] },
        steps: [
          {
            html: `<div class="stage-container">
                    <i class="fas fa-envelope visual-icon active"></i>
                    <h3>Nouveau Ticket</h3>
                    <div class="visual-card">
                      <strong>De:</strong> Julie M.<br>
                      <strong>Sujet:</strong> “Taille trop petite...”
                    </div>
                  </div>`,
            log: "WEBHOOK: Ticket Created (Zendesk)."
          },
          {
            html: `<div class="stage-container">
                    <i class="fas fa-brain visual-icon active" style="color:var(--danger)"></i>
                    <h3>Analyse IA</h3>
                    <div class="visual-card alert">
                      <strong>Sentiment:</strong> Négatif<br>
                      <strong>Intention:</strong> Retour
                    </div>
                  </div>`,
            log: "NLP: Sentiment Score -0.8. Category: Return."
          },
          {
            html: `<div class="stage-container">
                    <i class="fas fa-shipping-fast visual-icon active" style="color:var(--success)"></i>
                    <h3>Résolution Auto</h3>
                    <div class="visual-card approved">
                      Étiquette Retour Générée<br>
                      Email envoyé.
                      <div class="float-badge show">Ticket Clos</div>
                    </div>
                  </div>`,
            log: "ACTION: Generate Label & Close Ticket."
          }
        ]
      }
    };

    let currentSim = null;
    let speed = 1;

    function startSim(key){
      currentSim = scenarios[key];
      document.getElementById('simTitle').innerText = currentSim.title;
      document.getElementById('simModal').classList.add('active');
      document.getElementById('stage').innerHTML = '<div style="color:#666">Prêt.</div>';
      document.getElementById('terminal').innerHTML = '<div>> System Ready.</div>';
      document.getElementById('btnRun').disabled = false;

      audit('Admin', key==='design'?'NetDesignX':key==='promo'?'NetPromoX':key==='cat'?'NetCatX':'NetCareX',
        'SIM_OPEN', currentSim.title, 'INFO');
    }

    function closeSim(){ document.getElementById('simModal').classList.remove('active'); }

    function toggleSpeed(){
      speed = (speed===1?2:(speed===2?3:1));
      document.getElementById('speedLbl').innerText = 'x'+speed;
      toast('info','Simulation',`Vitesse: x${speed}`);
    }

    function runSequence(){
      const btn = document.getElementById('btnRun');
      btn.disabled = true;
      const term = document.getElementById('terminal');
      const stage = document.getElementById('stage');
      term.innerHTML = '';

      const stepDelay = Math.round(2000 / speed);

      currentSim.steps.forEach((step, i)=>{
        setTimeout(()=>{
          stage.innerHTML = step.html;

          const time = new Date().toLocaleTimeString();
          const line = `<div class="term-line"><span class="term-time">[${time}]</span> <span class="term-text">${step.log}</span></div>`;
          term.insertAdjacentHTML('beforeend', line);
          term.scrollTop = term.scrollHeight;

          // Inject logs in main stream (réalisme)
          pushLog(
            currentSim.title.split(':')[0],
            step.log.split(':')[0] || 'STEP',
            step.log,
            'OK'
          );

          if(i === currentSim.steps.length - 1){
            setTimeout(()=> {
              const kpiText = computeScenarioKPIs(currentSim);
              term.insertAdjacentHTML('beforeend',
                `<div class="term-line"><span class="term-text term-highlight">>>> KPIs:</span> <span class="term-text">${kpiText}</span></div>`
              );
              term.insertAdjacentHTML('beforeend',
                `<div class="term-line"><span style="color:var(--success)">>>> PROCESS COMPLETED.</span></div>`
              );
              btn.disabled = false;

              toast('ok','Simulation',`Séquence terminée. KPIs générés.`);
            }, Math.round(1000 / speed));
          }
        }, i * stepDelay);
      });
    }

    function computeScenarioKPIs(sim){
      // KPI "business-friendly" + mise à jour dashboard
      if(sim === scenarios.design){
        const cycle = rand(sim.kpis.cycleMin[0], sim.kpis.cycleMin[1]);
        const cost = (Math.random()*(sim.kpis.cost[1]-sim.kpis.cost[0]) + sim.kpis.cost[0]).toFixed(2);
        setText('dLead', (cycle/60).toFixed(1)+' h');
        setText('dCost', cost+'€');
        setText('kpiCycle', cycle+' min');
        audit('Admin','NetDesignX','SIM_RESULT',`cycle=${cycle}min, cost=${cost}€`, 'INFO');
        return `cycle_time=${cycle}min | proto_cost=${cost}€ | handoff=${sim.kpis.handoff}`;
      }

      if(sim === scenarios.promo){
        const roi = (Math.random()*(sim.kpis.roi[1]-sim.kpis.roi[0]) + sim.kpis.roi[0]).toFixed(1);
        const open = rand(sim.kpis.open[0], sim.kpis.open[1]);
        const rev = rand(sim.kpis.revenue[0], sim.kpis.revenue[1]);
        setText('pROI', roi+'x');
        setText('pOpen', open+'%');
        setText('kpiROI', roi+'x');
        audit('Admin','NetPromoX','SIM_RESULT',`roi=${roi}x, open=${open}%, revenue=${rev}€`, 'INFO');
        return `roi=${roi}x | open_rate=${open}% | revenue=${rev}€`;
      }

      if(sim === scenarios.cat){
        const errs = rand(sim.kpis.pimErr[0], sim.kpis.pimErr[1]);
        const pub = rand(sim.kpis.publishMin[0], sim.kpis.publishMin[1]);
        const comp = (Math.random()*(sim.kpis.completeness[1]-sim.kpis.completeness[0]) + sim.kpis.completeness[0]).toFixed(1);
        setText('cErr', String(errs));
        setText('cPub', pub+' min');
        setText('cComp', comp+'%');
        setText('kpiPimErr', (errs*0.12).toFixed(2)+'%');
        audit('Admin','NetCatX','SIM_RESULT',`errors=${errs}, publish=${pub}min, completeness=${comp}%`, errs? 'WARN':'INFO');
        return `pim_errors=${errs} | publish_time=${pub}min | completeness=${comp}%`;
      }

      if(sim === scenarios.care){
        const sla = rand(sim.kpis.sla[0], sim.kpis.sla[1]);
        const frt = rand(sim.kpis.frtMin[0], sim.kpis.frtMin[1]);
        const csat = (Math.random()*(sim.kpis.csat[1]-sim.kpis.csat[0]) + sim.kpis.csat[0]).toFixed(2);
        setText('sSLA', sla+'%');
        setText('sFRT', frt+' min');
        setText('sCSAT', csat+'/5');
        setText('kpiSLA', sla+'%');
        audit('Admin','NetCareX','SIM_RESULT',`sla=${sla}%, frt=${frt}min, csat=${csat}/5`, sla<90?'WARN':'INFO');
        return `sla_24h=${sla}% | first_response=${frt}min | csat=${csat}/5`;
      }
      return 'n/a';
    }

    /* =========================
       INIT
    ========================= */
    // seed audit events
    audit('System','OPS','BOOT','titan-v8.3.2 ready','INFO');
    audit('Admin','NetCatX','SYNC','Shopify connected (demo)','INFO');
    audit('Admin','NetCareX','SLA_POLICY','24h target=95%','INFO');
    audit('Admin','NetPromoX','TRACKING','UTM enabled','INFO');

    // baseline KPIs
    setText('kpiCycle','16 min');
    setText('kpiPimErr','0.00%');
    setText('kpiSLA','92%');
    setText('kpiROI','5.2x');
  </script>
</body>
</html>
